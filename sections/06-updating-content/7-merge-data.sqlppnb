{"cells":[{"kind":2,"language":"SQL++","value":"DROP COLLECTION test.samples.products IF EXISTS"},{"kind":2,"language":"SQL++","value":"CREATE COLLECTION test.samples.products IF NOT EXISTS"},{"kind":2,"language":"SQL++","value":"INSERT INTO test.samples.products (KEY, VALUE)\r\nVALUES (UUID(), { \"name\": \"soap\", \"price\": 22.50 }),\r\n    (UUID(), { \"name\": \"paper\", \"price\": 12.22 }),\r\n    (UUID(), { \"name\": \"scissors\", \"price\": 32.00 })\r\nRETURNING *      "},{"kind":2,"language":"SQL++","value":"MERGE INTO test.samples.products p\r\nUSING [\r\n    { \"product\": \"scissors\", \"new_price\": 25.00 },\r\n    { \"product\": \"chair\", \"new_price\": 44.15 },\r\n    { \"product\": \"paper\" }\r\n] source\r\nON p.name = source.product\r\nWHEN MATCHED THEN\r\n    UPDATE SET p.price = source.new_price\r\n    WHERE source.new_price IS NOT MISSING\r\nWHEN MATCHED THEN\r\n    DELETE WHERE source.new_price IS MISSING\r\nWHEN NOT MATCHED THEN\r\n    INSERT (KEY UUID(), \r\n    VALUE { \"name\": source.product, \"price\": source.new_price })\r\n    WHERE source.new_price IS NOT MISSING\r\nRETURNING p.*;"},{"kind":2,"language":"SQL++","value":"select *\r\nfrom test.samples.products"}]}