{"cells":[{"kind":1,"language":"markdown","value":"see https://docs.couchbase.com/cloud/n1ql/n1ql-language-reference/collectionops.html\r\n"},{"kind":1,"language":"markdown","value":"~TRANSFORM"},{"kind":2,"language":"SQL++","value":"select ARRAY val*2 FOR val IN [1, 2, 3] END"},{"kind":1,"language":"markdown","value":"~FILTER"},{"kind":2,"language":"SQL++","value":"select\r\n    ARRAY val FOR val IN [1, 2, 3] WHEN val >= 2 END,\r\n    ARRAY val FOR i:val IN [1, 2, 3] WHEN i >= 1 END"},{"kind":1,"language":"markdown","value":"First array element conditional selection"},{"kind":2,"language":"SQL++","value":"select\r\n    FIRST val FOR val IN [1, 2, 3] WHEN val >= 2 END,\r\n    OBJECT \"value\":val FOR val IN [1, 2, 3] WHEN val >= 2 END"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    ARRAY rating FOR rating IN person.ratings\r\n    WHEN rating > 4.0 END as good_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nwhere ARRAY_LENGTH(person.ratings) > 1"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    ARRAY rating FOR i:rating IN person.ratings\r\n    WHEN i > 0 END as last_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nwhere ARRAY_LENGTH(person.ratings) > 1"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    FIRST rating FOR rating IN person.ratings\r\n    WHEN rating > 4.0 END as first_good_rating\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nwhere ARRAY_LENGTH(person.ratings) > 1"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    OBJECT \"value\":rating FOR rating IN person.ratings\r\n    WHEN rating > 4.0 END as first_good_rating\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nwhere ARRAY_LENGTH(person.ratings) > 1"}]}