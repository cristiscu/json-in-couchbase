{"cells":[{"kind":1,"language":"markdown","value":"Uncorrelated Subqueries\r\n* with average book price\r\n* in the SELECT, WHERE, FROM clauses\r\n* Subquery + CTE"},{"kind":2,"language":"SQL++","value":"select b.title, b.price, \r\n    (select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2)[0] avg_price\r\nfrom test.samples.books b"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2)\r\nselect b.title, b.price, cte[0] avg_price\r\nfrom test.samples.books b, cte"},{"kind":2,"language":"SQL++","value":"select b.*\r\nfrom test.samples.books b\r\nwhere b.price > (select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2)[0]"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2)\r\nselect b.*\r\nfrom test.samples.books b\r\nwhere b.price > cte[0]"},{"kind":2,"language":"SQL++","value":"select b.*\r\nfrom (\r\n    select b3.* from test.samples.books b3\r\n    where b3.price > (\r\n        select raw ROUND(AVG(b2.price), 2)\r\n        from test.samples.books b2)[0]) b"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2),\r\ncte2 as (\r\n    select b3.* from test.samples.books b3\r\n    where b3.price > cte[0])\r\nselect b.*\r\nfrom cte2 b"},{"kind":1,"language":"markdown","value":"Correlated Subqueries\r\n* on the new WHERE clause, only for the books in the same category\r\n* in the SELECT, WHERE, FROM clauses\r\n* Subquery + CTE"},{"kind":2,"language":"SQL++","value":"select b.title, b.price, \r\n    (select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2\r\n    where b2.category = b.category)[0] avg_price\r\nfrom test.samples.books b"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select category, ROUND(AVG(price), 2) as avg_price\r\n    from test.samples.books\r\n    group by category)\r\nselect b.title, b.price, cte.avg_price\r\nfrom test.samples.books b\r\n    inner join cte\r\n    on cte.category = b.category"},{"kind":2,"language":"SQL++","value":"select b.*\r\nfrom test.samples.books b\r\nwhere b.price > (select raw ROUND(AVG(b2.price), 2)\r\n    from test.samples.books b2\r\n    where b2.category = b.category)[0]"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select category, ROUND(AVG(price), 2) as avg_price\r\n    from test.samples.books\r\n    group by category)\r\nselect b.title, b.price, cte.avg_price\r\nfrom test.samples.books b\r\n    inner join cte\r\n    on cte.category = b.category\r\nwhere b.price > cte.avg_price"},{"kind":2,"language":"SQL++","value":"select b.*\r\nfrom (\r\n    select b3.*\r\n    from test.samples.books b3\r\n    where b3.price > (\r\n        select raw ROUND(AVG(b2.price), 2)\r\n        from test.samples.books b2\r\n        where b2.category = b3.category)[0]) b"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select category, ROUND(AVG(price), 2) as avg_price\r\n    from test.samples.books\r\n    group by category),\r\ncte2 as (\r\n    select b.title, b.price, cte.avg_price\r\n    from test.samples.books b\r\n        inner join cte\r\n        on cte.category = b.category\r\n    where b.price > cte.avg_price)\r\nselect cte2.*\r\nfrom cte2"}]}