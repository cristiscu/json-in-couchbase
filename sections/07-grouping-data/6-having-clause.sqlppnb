{"cells":[{"kind":2,"language":"SQL++","value":"select person.name,\r\n    ARRAY_AVG(person.ratings) as avg_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\ngroup by person.name, person.ratings"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    ARRAY_AVG(person.ratings) as avg_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nWHERE LOWER(person.name) <> 'adam'\r\ngroup by person.name, person.ratings"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    ARRAY_AVG(person.ratings) as avg_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\ngroup by person.name, person.ratings\r\nHAVING LOWER(person.name) <> 'adam'"},{"kind":2,"language":"SQL++","value":"select person.name,\r\n    TRUNC(ARRAY_AVG(person.ratings), 2) as avg_ratings\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nWHERE person.ratings IS NOT MISSING\r\ngroup by person.name, person.ratings\r\nHAVING ARRAY_LENGTH(person.ratings) > 1\r\norder by avg_ratings DESC"},{"kind":2,"language":"SQL++","value":"select raw { person.name: TRUNC(ARRAY_AVG(person.ratings), 2) }\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] person\r\nWHERE person.ratings IS NOT MISSING\r\ngroup by person.name, person.ratings\r\nHAVING ARRAY_LENGTH(person.ratings) > 1\r\n    and ARRAY_AVG(person.ratings) > 4.0\r\norder by ARRAY_AVG(person.ratings) DESC"},{"kind":2,"language":"SQL++","value":"select name, ROW_NUMBER() over (order by name) as rn\r\nfrom [\r\n    { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n    { \"name\": 'Mary', \"ratings\": [5.0] },\r\n    { \"name\": 'Adam' },\r\n    { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n] p\r\n-- where rn >= 2\r\norder by name"},{"kind":2,"language":"SQL++","value":"with cte as (\r\n    select name, ROW_NUMBER() over (order by name) as rn\r\n    from [\r\n        { \"name\": 'John', \"ratings\": [3.5, 5.0, 4.5] },\r\n        { \"name\": 'Mary', \"ratings\": [5.0] },\r\n        { \"name\": 'Adam' },\r\n        { \"name\": 'Jack', \"ratings\": [4.8, 4.4, 4.9] }\r\n    ] person\r\n    order by name)\r\nselect cte.*\r\nfrom cte\r\nwhere rn >= 2"}]}