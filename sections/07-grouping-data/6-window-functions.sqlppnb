{"cells":[{"kind":2,"language":"SQL++","value":"select p.*\r\nfrom [\r\n    { \"name\": 'John', \"bill\": 100, \"id\": 3 },\r\n    { \"name\": 'John', \"bill\": 200, \"id\": 1 },\r\n    { \"name\": 'Mary', \"bill\": 180, \"id\": 2 }\r\n] p\r\norder by name, id"},{"kind":2,"language":"SQL++","value":"select name, COUNT(id) as count, \r\n    SUM(bill) as sum, AVG(bill) as avg, MEDIAN(bill) as median,\r\n    MIN(bill) as min, MAX(bill) as max\r\nfrom [\r\n    { \"name\": 'John', \"bill\": 100, \"id\": 3 },\r\n    { \"name\": 'John', \"bill\": 200, \"id\": 1 },\r\n    { \"name\": 'Mary', \"bill\": 180, \"id\": 2 }\r\n] p\r\ngroup by name\r\norder by name"},{"kind":2,"language":"SQL++","value":"select name, id, bill,\r\n    LAG(id) OVER win as prev_id,\r\n    LEAD(id) OVER win as next_id\r\nfrom [\r\n    { \"name\": 'John', \"bill\": 100, \"id\": 3 },\r\n    { \"name\": 'John', \"bill\": 200, \"id\": 1 },\r\n    { \"name\": 'Mary', \"bill\": 180, \"id\": 2 }\r\n] p\r\nWINDOW win AS (PARTITION BY name ORDER BY id)\r\norder by name, id"},{"kind":2,"language":"SQL++","value":"select name, id, bill,\r\n    bill + IFNULL(LAG(bill, 1) OVER win, 0) as crt_balance,\r\n    LAST_VALUE(bill) OVER win as last_entry,\r\n    ROW_NUMBER() OVER win as entry_id\r\nfrom [\r\n    { \"name\": 'John', \"bill\": 100, \"id\": 3 },\r\n    { \"name\": 'John', \"bill\": 200, \"id\": 1 },\r\n    { \"name\": 'Mary', \"bill\": 180, \"id\": 2 }\r\n] p\r\nWINDOW win AS (PARTITION BY name ORDER BY id)\r\norder by name, id"},{"kind":2,"language":"SQL++","value":"select name, id, bill,\r\n    bill + IFNULL(LAG(bill, 1) OVER win, 0) as crt_balance,\r\n    LAST_VALUE(bill) OVER (win\r\n        ROWS BETWEEN UNBOUNDED PRECEDING\r\n        AND UNBOUNDED FOLLOWING) as last_entry,\r\n    ROW_NUMBER() OVER win2 as rank_by_bill\r\nfrom [\r\n    { \"name\": 'John', \"bill\": 100, \"id\": 3 },\r\n    { \"name\": 'John', \"bill\": 200, \"id\": 1 },\r\n    { \"name\": 'Mary', \"bill\": 180, \"id\": 2 }\r\n] p\r\nWINDOW win AS (PARTITION BY name ORDER BY id),\r\n    win2 AS (ORDER BY bill DESC)\r\norder by name, id"},{"kind":1,"language":"markdown","value":"TODO: ROW_NUMBER w/ subquery!"}]}